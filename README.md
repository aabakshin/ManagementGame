# Игра "Менеджмент"
Данная игра была предложена фирмой Avalon Hill Company для обучения основам управления предприятием. Ч.Уэзерелл отметил чрезвычайную привлекательность этой игры в качестве упражнения для
программистов. В этом репозитории находится моя реализация этой игры на чистом Си. Некоторые части программы также реализованы на C++ без использования каких-либо сторонних библиотек, контейнеров STL и т.д.
## Состав проекта
Проект сделан по клиент-серверной архитектуре. Клиентом может быть как реальный игрок, так и компьютер, стратегия поведения которого задаётся скриптовыми текстовыми файлами на специально созданном для него языке.
Все скрипты должны находиться в директории `game_scripts`. Краткое описание скриптового языка будет представлено далее.
### /
- `binaries`: Содержит исполняемые модули и их исходные коды, а также Makefile'ы для сборки проекта
- `game_scripts`: Содержит скрипты для интерпретации игроком-компьютером
- `includes`: Содержит заголовочные файлы модулей для всего проекта
- `libs`: Содержит исходные коды и объектные файлы модулей для всего проекта 
- `tests`: Содержит файлы и исходные тексты для тестирования некоторых частей проекта(например, контейнеров)
### /binaries
- `bot_mg`: Содержит исходник, бинарник и Makefile для сборки клиента-компьютера
- `client`: Содержит исходник, бинарник и Makefile для сборки клиента-игрока
- `server`: Содержит исходник, бинарник и Makefile для сборки сервера
## Запуск проекта
Проект собирался под Linux Mint 20.3, версия ядра Linux: 5.4.0-148-generic, архитектура: x86-64
Для запуска проекта необходимо:
- Установить SSH-сервер:
	```
	$ sudo apt update
	$ sudo apt upgrade
	```

	```
	$ sudo apt install openssh-server
	```

	```
	$ systemctl status ssh
	```
	Если всё настроено правильно, то должна быть надпись о том, что сервер работает

- Настроить ssh-туннель с github-сервером:
	1. Создание нового ключа SSH и привязка к ssh-agent:
	```
	https://docs.github.com/ru/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent
	```
	2. Добавление нового ключа SSH в учётную запись GitHub:
	```
	https://docs.github.com/ru/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account
	```
	3. Проверка работы SSH-соединения:
	```
	$ ssh -T git@github.com
	```

- Клонировать репозиторий:
	```
	git clone git@github.com:aabakshin/ManagementGame.git
	```

- Собрать бинарник сервера: Перейти в директорию `/binaries/server/`. Ввести команду `make server`
- Собрать бинарник клиента-игрока: Перейти в директорию `/binaries/client/`. Ввести команду `make client`
- Собрать бинарник клиента-компьютера(если нужно подключить ботов к игре): Перейти в директорию `/binaries/bot_mg/`. Ввести команду `make bot_mg`
- Далее запускается один экземпляр сервера: `./server 7777`, порт указывается любой свободный
- Далее запускаются несколько экземпляров игроков: `./client 192.168.50.128 7777`, в параметрах указывается адрес сервера и порт
- Также можно добавлять ботов, для этого перед стартом игры(в лобби), создаются экземпляры ботов: `./bot_mg 192.168.50.128 7777 ../game_scripts/example.txt`, последний параметр - путь до файла со скриптом для бота.
- При необходимости пересборки проекта можно для каждого из модулей `server`, `client`, `bot_mg` в их директориях предварительно выполнить команду: `make clean`
## Описание скриптового языка
### Общее описание
Программа на этом языке состоит из операторов, каждый из которых может быть помечен меткой. Для упрощения анализа имя метки начинается всегда с символа `@` и заканчивается `:`; имя метки может состоять из латинских букв, цифр и знаковподчёркивания. Если оператор начинается не с метки, считается, что этот оператор не имеет метки. Конец оператора обозначается `;`.
В языке присутствуют следующие операторы:
- оператор присваивания
- оператор безусловного перехода(`goto`)
- условный оператор(`if`)
- операторы игровых действий(`buy`, `sell`, `prod`, `build`, `endturn`)
- оператор отладочной печати(`print`)
### Арифметика и выражения
В языке поддерживаются арифметические операции:
- сложение(+), вычитание(-)
- умножение(\*), деление(/), взятие остатка от деления(%)
- операции сравнения(<, >, =)
- логические операции(&, |, !)
- унарный минус

Операции сравнения выдают значение 1 для истины, 0 для лжи

Наибольший приоритет имеют умножение, деление и остаток, далее сложение и вычитание, операции сравнения имеют низший приоритет

В качестве операндов могут выступать `константы`, `переменные`, `обращения к встроенным функциям`

В выражениях могут присутствовать круглые скобки любой вложенности.
### Переменные и присваивания
Переменные в языке имеют имена, начинающиеся с знака `$`. В имени переменной могут
присутствовать латинские буквы, цифры, знак подчёркивания. Переменные заносятся в спец.
таблицу в момент первого присваивания.

Оператор присваивания имеет следующий синтаксис:

`<присваивание> ::= <переменная> = <выражение> ';'`

`<переменная> ::= <имя_переменной>`

По обе стороны от знака присваивания допустимо любое кол-во пробельных символов.
### Условный оператор
Условный оператор имеет следующий синтаксис:

`<условный оператор> ::= 'if' <выражение> 'then' <оператор> ';'`
### Встроенные функции для получения игровой информации
Все имена функций начинаются со знака `?`. Если функция имеет аргументы, то вслед за именем функции должно идти заключённое в круглые скобки перечисление параметров функции через запятую. На данный момент есть следующие функции:
- `?my_id(без параметров)` - выдаёт номер игрока, присвоенный сервером нашему боту
- `?turn(без параметров)` - выдаёт текущий номер хода
- `?players(без параметров)` - выдаёт общее кол-во игроков
- `?active_players(без параметров)` - выдаёт кол-во игроков, продолжающих игру(не обанкротившихся и не вышедших из игры к настоящему моменту)
- `?supply(без параметров)` - выдаёт кол-во сырья, выставленное банком на продажу на текущий ход
- `?raw_price(без параметров)` - выдаёт минимальную стоимость сырья, определённую банком на текущий ход
- `?demand(без параметров)` - выдаёт кол-во продукции, которую банк намерен купить на текущем ходу
- `?production_price(без параметров)` - выдаёт максимальную цену продукции, определённую банком на текущий ход
- `?money(один параметр, номер игрока)` - выдаёт кол-во денег у заданного игрока
- `?raw(один параметр, номер игрока)` - выдаёт кол-во сырья у заданного игрока
- `?production(один параметр, номер игрока)` - выдаёт кол-во готовой продукции у заданного игрока
- `?factories(один параметр, номер игрока)` - выдаёт общее кол-во фабрик у заданного игрока
- `?manufactured(один параметр, номер игрока)` - сколько единиц продукции произведено игроком на **предыдущем** ходу
- `?result_raw_sold(один параметр, номер игрока)` - если данный игрок покупал сырьё на предыдущем ходу, выдаёт кол-во купленного сырья, в противном случае - ноль
- `?result_raw_price(один параметр, номер игрока)` - если данный игрок покупал сырьё на предыдущем ходу, выдаёт цену, по которой совершена покупка, в противном случае - ноль
- `?result_prod_bought(один параметр, номер игрока)` - сколько единиц продукции банк купил у данного игрока на предыдущем ходу
- `?result_prod_price(один параметр, номер игрока)` - если данный игрок продавал продукцию на предыдущем ходу, выдаёт цену, по которой совершена продажа, в противном случае - ноль
### Встроенные операторы для совершения игровых действий
Операторы для совершения игровых действий имеют следующий синтаксис:
`<игровой оператор> ::= <имя0> ';'`
`                       <имя1> <операнд> ';'`
`                       <имя2> <операнд1> ',' <операнд2> ';'`
`<имя0>             ::= 'endturn'`
`<имя1>             ::= 'prod' | 'build'`
`<имя2>             ::= 'buy' | 'sell'`
Текущий набор операторов следующий:
- `buy <количество>, <цена>` - выставить заявку на покупку заданного количества сырья по заданной цене
- `sell <количество>, <цена>` - выставить заявку на продажу заданного количества продукции по заданной цене
- `prod <количество>` - запустить в производство заданное кол-во продукции
- `build <количество>` - начать строительство заданного кол-ва фабрик
- `endturn` - сообщить серверу о завершении хода и дождаться сообщения от сервера о том, что начался новый ход

Во всех случаях операнды представляют собой произвольные допустимые арифметические выражения, правовычисляемое выражение(rvalue) или игровую функцию

Для проверки правильности синтаксиса используется символ `;`, обозначающий конец оператора

## Краткое описание порядка игры

